<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stoppa Mobilmasten - Sk√∂nab√§cksg√•ngen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Georgia, serif;
            background: linear-gradient(135deg, #faf9f6 0%, #f0efe9 100%);
            color: #2a2a2a;
            line-height: 1.6;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #1a3a1b 0%, #2c5f2d 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        
        .container { max-width: 900px; margin: 0 auto; }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .card h2 {
            color: #1a3a1b;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #4a8a4b;
            padding-bottom: 0.5rem;
        }
        
        .form-group { margin-bottom: 1.5rem; }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #1a3a1b;
        }
        
        .required { color: #c53030; }
        
        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0dfd8;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #2c5f2d;
        }
        
        textarea { min-height: 100px; resize: vertical; }
        
        .radio-group { display: flex; gap: 2rem; margin-top: 0.5rem; }
        .radio-option { display: flex; align-items: center; gap: 0.5rem; }
        .radio-option input { width: auto; }
        
        .help-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.25rem;
            font-style: italic;
        }
        
        button {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            margin-right: 1rem;
            margin-top: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2c5f2d 0%, #4a8a4b 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(44, 95, 45, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: #2c5f2d;
            border: 2px solid #2c5f2d;
        }
        
        .preview-box {
            background: #f8f8f8;
            border: 2px solid #e0dfd8;
            border-radius: 8px;
            padding: 2rem;
            margin-top: 2rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.8;
        }
        
        .success { 
            background: #2f855a; 
            color: white; 
            padding: 1rem; 
            border-radius: 8px; 
            margin-bottom: 1rem;
            display: none;
        }
        
        .error { 
            background: #c53030; 
            color: white; 
            padding: 1rem; 
            border-radius: 8px; 
            margin-bottom: 1rem;
            display: none;
        }
        
        @media print {
            .header, button, .card h2 { display: none; }
            .card { box-shadow: none; border: 1px solid #000; }
            .preview-box { 
                border: none; 
                background: white; 
                font-family: 'Times New Roman', serif; 
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üå≥ Stoppa Mobilmasten vid Sk√∂nab√§cksg√•ngen</h1>
        <p>Generera din erinran p√• 5 minuter</p>
    </div>

    <div class="container">
        <div class="card">
            <h2>Generera din erinran</h2>
            <div class="success" id="success">‚úì Erinran genererad! Scrolla ner f√∂r att se.</div>
            <div class="error" id="error">‚ö† V√§nligen fyll i alla obligatoriska f√§lt.</div>
            
            <form id="mainform">
                <div class="form-group">
                    <label>Fullst√§ndigt namn <span class="required">*</span></label>
                    <input type="text" id="namn" required placeholder="Ex: Anna Andersson">
                </div>

                <div class="form-group">
                    <label>Adress <span class="required">*</span></label>
                    <input type="text" id="adress" required placeholder="Ex: Hageb√§cksgatan 15">
                </div>

                <div class="form-group">
                    <label>Postnummer och ort <span class="required">*</span></label>
                    <input type="text" id="postort" required value="216 20 Malm√∂">
                </div>

                <div class="form-group">
                    <label>Telefon <span class="required">*</span></label>
                    <input type="tel" id="telefon" required placeholder="Ex: 070-123 45 67">
                </div>

                <div class="form-group">
                    <label>E-post <span class="required">*</span></label>
                    <input type="email" id="epost" required placeholder="Ex: anna.andersson@example.com">
                </div>

                <div class="form-group">
                    <label>Ungef√§rligt avst√•nd till masten (meter)</label>
                    <input type="number" id="avstand" placeholder="Ex: 105">
                    <div class="help-text">M√§t p√• Google Maps. Masten st√•r vid Svansj√∂gatan/Bellevueg√•rden.</div>
                </div>

                <div class="form-group">
                    <label>√Ñr du sak√§gare? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="sakagare-ja" name="sakagare" value="ja" required>
                            <label for="sakagare-ja" style="margin:0; font-weight:normal;">Ja (bor inom 150m)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="sakagare-nej" name="sakagare" value="nej">
                            <label for="sakagare-nej" style="margin:0; font-weight:normal;">Nej (bor l√§ngre bort)</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Har du f√•tt grannmeddelande fr√•n kommunen?</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="grannbrev-ja" name="grannbrev" value="ja">
                            <label for="grannbrev-ja" style="margin:0; font-weight:normal;">Ja</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="grannbrev-nej" name="grannbrev" value="nej">
                            <label for="grannbrev-nej" style="margin:0; font-weight:normal;">Nej</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Hur p√•verkas du specifikt? (valfritt)</label>
                    <textarea id="paverkan" placeholder="Ex: Masten kommer synas direkt fr√•n mitt k√∂k..."></textarea>
                </div>

                <button type="button" class="btn-primary" onclick="generera()">üìÑ Generera erinran</button>
            </form>

            <div id="preview" style="display:none;">
                <h3 style="margin-top: 2rem; color: #1a3a1b;">F√∂rhandsvisning:</h3>
                <div class="preview-box" id="previewtext"></div>
                <button type="button" class="btn-secondary" onclick="kopiera()">üìã Kopiera text</button>
                <button type="button" class="btn-primary" onclick="laddaNerPDF()">üì• Ladda ner PDF</button>
                <button type="button" class="btn-secondary" onclick="skrivUtRen()">üñ®Ô∏è Skriv ut (ren)</button>
                
                <p style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
                    <strong>S√• h√§r skickar du:</strong><br>
                    1. Ladda ner PDF ELLER kopiera text<br>
                    2. E-post: stadsbyggnadskontoret@malmo.se (√Ñmne: Dnr SBN 2025-004109)<br>
                    3. Post: Stadsbyggnadskontoret, 205 80 Malm√∂
                </p>
            </div>
        </div>
    </div>

    <script>
        function generera() {
            console.log('Generera called');
            
            var form = document.getElementById('mainform');
            if (!form.checkValidity()) {
                form.reportValidity();
                document.getElementById('error').style.display = 'block';
                setTimeout(function() {
                    document.getElementById('error').style.display = 'none';
                }, 3000);
                return;
            }

            var namn = document.getElementById('namn').value;
            var adress = document.getElementById('adress').value;
            var postort = document.getElementById('postort').value;
            var telefon = document.getElementById('telefon').value;
            var epost = document.getElementById('epost').value;
            var avstand = document.getElementById('avstand').value;
            
            var sakagareEl = document.querySelector('input[name="sakagare"]:checked');
            if (!sakagareEl) {
                alert('V√§nligen v√§lj om du √§r sak√§gare.');
                return;
            }
            var sakagare = sakagareEl.value;
            
            var grannbrevEl = document.querySelector('input[name="grannbrev"]:checked');
            var grannbrev = grannbrevEl ? grannbrevEl.value : 'vet ej';
            
            var paverkan = document.getElementById('paverkan').value;

            var idag = new Date().toLocaleDateString('sv-SE');
            var dokumentTyp = sakagare === 'ja' ? 'ERINRAN' : 'YTTRANDE';
            
            var text = dokumentTyp + ' MOT BYGGLOVSANS√ñKAN\n\n';
            text += 'Till: Malm√∂ Stadsbyggnadsn√§mnd\n';
            text += '√Ñrende: Dnr SBN 2025-004109\n';
            text += 'Fr√•n: ' + namn + ', ' + adress + '\n\n';
            text += dokumentTyp.toUpperCase() + ' MOT BYGGLOVSANS√ñKAN\n\n';
            text += 'Jag framf√∂r h√§rmed ' + dokumentTyp.toLowerCase() + ' mot bygglovsans√∂kan Dnr SBN 2025-004109 avseende uppf√∂rande av 24 meter h√∂g monopole och teknikbod p√• fastigheten Hyllie 160:12, Svansj√∂gatan/Bellevueg√•rden.\n\n';
            text += 'SAK√ÑGARSKAP OCH P√ÖVERKAN\n\n';
            text += 'Jag √§r boende p√• ' + adress;
            if (avstand) {
                text += ' vilket ligger cirka ' + avstand + ' meter fr√•n den planerade masten';
            }
            text += '.\n\n';

            if (grannbrev === 'nej') {
                text += 'Jag har INTE erh√•llit n√•got grannmeddelande fr√•n stadsbyggnadskontoret trots ';
                text += sakagare === 'ja' ? 'att jag √§r sak√§gare och bor inom p√•verkansomr√•det' : 'n√§rhet till projektet';
                text += '.\n\n';
            }

            if (paverkan) {
                text += paverkan + '\n\n';
            }

            text += 'GRUNDER F√ñR MIN ' + dokumentTyp.toUpperCase() + '\n\n';
            text += 'Jag inst√§mmer fullt ut i och h√§nvisar till den detaljerade gemensamma erinran fr√•n Zlatan Alikadic, Hageb√§cksgatan 9, daterad 2026-02-11. S√§rskilt vill jag framh√•lla:\n\n';
            text += '1. Bristande sak√§garunderr√§ttelse: M√•nga boende inom 150 meter';
            if (grannbrev === 'nej') text += ', inklusive jag sj√§lv,';
            text += ' har inte erh√•llit grannmeddelande trots att vi √§r sak√§gare enligt PBL 9 kap. 25 ¬ß.\n\n';
            text += '2. Bryter mot omr√•dets karakt√§r: En 24 meter h√∂g industriell mast passar inte i detta villaomr√•de med radhus och i n√§rheten av det v√§rdefulla rekreationsstr√•ket Sk√∂nab√§cksg√•ngen.\n\n';
            text += '3. Bristande utredning: Ans√∂kan saknar visualiseringar, skugganalys, utredning av p√•verkan p√• k√∂rsb√§rsall√©n och alternativlokalisering.\n\n';
            text += '4. Stark lokal opinion: 104+ Malm√∂bor har r√∂stat emot projektet via Malm√∂initiativ EF20260029 "Bevara k√∂rsb√§rsall√©n Sk√∂nab√§cksg√•ngen".\n\n';
            text += '5. Tidigare avslag: Samma s√∂kande (Net4Mobility/Vinnergi) har tidigare under 2025 f√•tt avslag f√∂r liknande projekt i Gamla Roseng√•rd och V√§stra Kattarp.\n\n';
            text += 'YRKANDE\n\n';
            text += 'Jag yrkar att stadsbyggnadsn√§mnden avsl√•r denna bygglovsans√∂kan.\n\n';
            text += 'Alternativt, om ans√∂kan inte avsl√•s, yrkar jag att √§rendet √•terremitteras med krav p√•:\n';
            text += '- Korrekt sak√§garunderr√§ttelse till alla ber√∂rda\n';
            text += '- Visualiseringar som visar mastens faktiska p√•verkan\n';
            text += '- Utredning av p√•verkan p√• k√∂rsb√§rsall√©n\n';
            text += '- Analys av alternativa placeringar\n\n';
            text += '√ñNSKEM√ÖL\n\n';
            text += 'Jag √∂nskar:\n';
            text += '- Bli delgiven beslut i √§rendet\n';
            text += '- Information om eventuell bygganm√§lan och byggstart\n';
            text += '- Att f√• information om eventuell syn p√• plats\n\n';
            text += 'Med v√§nlig h√§lsning,\n\n';
            text += namn + '\n';
            text += adress + '\n';
            text += postort + '\n';
            text += 'Telefon: ' + telefon + '\n';
            text += 'E-post: ' + epost + '\n\n';
            text += 'Datum: ' + idag + '\n\n';
            text += 'BILAGOR\n';
            text += '- Malm√∂initiativ EF20260029 (h√§nvisning)\n';
            text += '- Gemensam erinran fr√•n Zlatan Alikadic (bifoga g√§rna)\n';

            document.getElementById('previewtext').textContent = text;
            document.getElementById('preview').style.display = 'block';
            document.getElementById('success').style.display = 'block';
            
            document.getElementById('preview').scrollIntoView({ behavior: 'smooth' });

            setTimeout(function() {
                document.getElementById('success').style.display = 'none';
            }, 3000);
            
            console.log('Erinran generated successfully');
        }

        function kopiera() {
            var text = document.getElementById('previewtext').textContent;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(function() {
                    alert('‚úì Texten har kopierats!');
                }).catch(function() {
                    kopieraFallback(text);
                });
            } else {
                kopieraFallback(text);
            }
        }

        function kopieraFallback(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.top = "0";
            textArea.style.left = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('‚úì Texten har kopierats!');
            } catch (err) {
                alert('Markera texten och tryck Ctrl+C (Cmd+C p√• Mac).');
            }
            
            document.body.removeChild(textArea);
        }

        function laddaNerPDF() {
            try {
                if (typeof jsPDF === 'undefined') {
                    alert('PDF-biblioteket laddas... F√∂rs√∂k igen om 2 sekunder.');
                    setTimeout(laddaNerPDF, 2000);
                    return;
                }

                var text = document.getElementById('previewtext').textContent;
                var namn = document.getElementById('namn').value;
                
                var doc = new jsPDF.jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                var pageWidth = 210;
                var pageHeight = 297;
                var margin = 25;
                var maxWidth = pageWidth - (margin * 2);
                var fontSize = 11;
                var lineHeight = 6;
                
                doc.setFont('times', 'normal');
                doc.setFontSize(fontSize);

                var lines = doc.splitTextToSize(text, maxWidth);
                
                var y = margin;

                for (var i = 0; i < lines.length; i++) {
                    if (y + lineHeight > pageHeight - margin) {
                        doc.addPage();
                        y = margin;
                    }
                    
                    doc.text(lines[i], margin, y);
                    y += lineHeight;
                }

                var filename = 'Erinran_' + namn.replace(/\s+/g, '_') + '_' + new Date().toISOString().split('T')[0] + '.pdf';
                doc.save(filename);
                
                alert('‚úì PDF nedladdad! Kontrollera din nedladdningsmapp.');
                
            } catch (error) {
                console.error('PDF-fel:', error);
                alert('PDF-generering misslyckades. Anv√§nd "Skriv ut (ren)" ist√§llet och spara som PDF fr√•n utskriftsdialogen.');
            }
        }

        function skrivUtRen() {
            var text = document.getElementById('previewtext').textContent;
            var namn = document.getElementById('namn').value;
            
            var printWindow = window.open('', '_blank', 'width=800,height=600');
            printWindow.document.write('<!DOCTYPE html><html><head><meta charset="UTF-8">');
            printWindow.document.write('<title>Erinran - ' + namn + '</title>');
            printWindow.document.write('<style>');
            printWindow.document.write('@page { margin: 2.5cm; }');
            printWindow.document.write('body { font-family: "Times New Roman", serif; font-size: 12pt; line-height: 1.6; color: #000; max-width: 21cm; margin: 0 auto; padding: 1cm; }');
            printWindow.document.write('pre { white-space: pre-wrap; font-family: "Times New Roman", serif; margin: 0; }');
            printWindow.document.write('</style></head><body>');
            printWindow.document.write('<pre>' + text.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</pre>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            
            setTimeout(function() {
                printWindow.print();
            }, 500);
        }
    </script>
</body>
</html>
